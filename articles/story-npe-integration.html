<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Numerical integration non-proportional effect size in group sequential design • gsDesign2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Numerical integration non-proportional effect size in group sequential design">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsDesign2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2.16</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/gsDesign2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Merck/gsDesign2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Numerical integration non-proportional effect size in group sequential design</h1>
                        <h4 data-toc-skip class="author">Keaven M.
Anderson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Merck/gsDesign2/blob/main/vignettes/articles/story-npe-integration.Rmd" class="external-link"><code>vignettes/articles/story-npe-integration.Rmd</code></a></small>
      <div class="d-none name"><code>story-npe-integration.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/gsDesign2/">gsDesign2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>We have provided asymptotic distribution theory and notation for
group sequential boundaries in
<code>vignettes/articles/story-npe-background.Rmd</code>.</p>
<p>This vignettes generalize computational algorithms provided in
Chapter 19 of <span class="citation">Jennison and Turnbull (1999)</span>
that are used to compute boundary crossing probabilities as well as
derive boundaries for group sequential designs.</p>
</div>
<div class="section level3">
<h3 id="asymptotic-normal-and-boundary-crossing-probabilities">Asymptotic normal and boundary crossing probabilities<a class="anchor" aria-label="anchor" href="#asymptotic-normal-and-boundary-crossing-probabilities"></a>
</h3>
<p>We assume
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mn>1</mn></msub><mo>,</mo><mi>⋯</mi><mo>,</mo><msub><mi>Z</mi><mi>K</mi></msub></mrow><annotation encoding="application/x-tex">Z_1,\cdots,Z_K</annotation></semantics></math>
has a multivariate normal distribution with variance for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">1\leq k\leq K</annotation></semantics></math>
of <span class="math display">$$\hbox{Var}(Z_k) = 1$$</span> and the
expected value is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Z</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msqrt><msub><mi>ℐ</mi><mi>k</mi></msub></msqrt><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msqrt><msub><mi>n</mi><mi>k</mi></msub></msqrt><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>X</mi><mo accent="true">‾</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">E(Z_{k})= \sqrt{\mathcal{I}_k}\theta(t_{k})= \sqrt{n_k}E(\bar X_k) .</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="notation-for-boundary-crossing-probabilities">Notation for boundary crossing probabilities<a class="anchor" aria-label="anchor" href="#notation-for-boundary-crossing-probabilities"></a>
</h3>
<p>We use a shorthand notation in this section to have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
represent
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta()</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\theta=0</annotation></semantics></math>
to represent
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≡</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\theta(t)\equiv 0</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
We denote the probability of crossing the upper boundary at analysis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
without previously crossing a bound by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>P</mi><mi>θ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>Z</mi><mi>k</mi></msub><mo>≥</mo><msub><mi>b</mi><mi>k</mi></msub><mo stretchy="false" form="postfix">}</mo><msubsup><mo>∩</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false" form="prefix">{</mo><msub><mi>a</mi><mi>j</mi></msub><mo>≤</mo><msub><mi>Z</mi><mi>j</mi></msub><mo>&lt;</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\alpha_{k}(\theta)=P_{\theta}(\{Z_{k}\geq b_{k}\}\cap_{j=1}^{i-1}\{a_{j}\leq Z_{j}&lt; b_{j}\}),</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">k=1,2,\ldots,K.</annotation></semantics></math></p>
<p>Next, we consider analogous notation for the lower bound. For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k=1,2,\ldots,K</annotation></semantics></math>
denote the probability of crossing a lower bound at analysis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
without previously crossing any bound by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>P</mi><mi>θ</mi></msub><mo stretchy="false" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Z</mi><mi>k</mi></msub><mo>&lt;</mo><msub><mi>a</mi><mi>k</mi></msub><mo stretchy="false" form="postfix">}</mo><msubsup><mo>∩</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false" form="prefix">{</mo><msub><mi>a</mi><mi>j</mi></msub><mo>≤</mo><msub><mi>Z</mi><mi>j</mi></msub><mo>&lt;</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\beta_{k}(\theta)=P_{\theta}((Z_{k}&lt; a_{k}\}\cap_{j=1}^{k-1}\{ a_{j}\leq Z_{j}&lt; b_{j}\}).</annotation></semantics></math>
For symmetric testing for analysis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
we would have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>k</mi></msub><mo>=</mo><mo>−</mo><msub><mi>b</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">a_k= - b_k</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\beta_k(0)=\alpha_k(0),</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k=1,2,\ldots,K</annotation></semantics></math>.
The total lower boundary crossing probability for a trial is denoted by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≡</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>β</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\beta(\theta)\equiv\sum_{k=1}^{K}\beta_{k}(\theta).</annotation></semantics></math>
Note that we can also set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>k</mi></msub><mo>=</mo><mo>−</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">a_k= -\infty</annotation></semantics></math>
for any or all analyses if a lower bound is not desired,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k=1,2,\ldots,K</annotation></semantics></math>;
thus, we will not use the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>α</mi><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha^+(\theta)</annotation></semantics></math>
notation here. For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&lt;</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k&lt;K</annotation></semantics></math>,
we can set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>k</mi></msub><mo>=</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">b_k=\infty</annotation></semantics></math>
where an upper bound is not desired. Obviously, for each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>,
we want either
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>k</mi></msub><mo>&gt;</mo><mo>−</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">a_k&gt;-\infty</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>k</mi></msub><mo>&lt;</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">b_k&lt;\infty</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="recursive-algorithms-for-numerical-integration">Recursive algorithms for numerical integration<a class="anchor" aria-label="anchor" href="#recursive-algorithms-for-numerical-integration"></a>
</h3>
<p>We now provide a small update to the algorithm of Chapter 19 of <span class="citation">Jennison and Turnbull (1999)</span> to do the numerical
integration required to compute the boundary crossing probabilities of
the previous section and also identifying group sequential boundaries
satisfying desired characteristics. The key to these calculations is the
conditional power identity in equation (1) above which allows building
recursive numerical integration identities to enable simple, efficient
numerical integration.</p>
<p>We define</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>g</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mi>d</mi><mrow><mi>d</mi><mi>z</mi></mrow></mfrac><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Z</mi><mn>1</mn></msub><mo>≤</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>−</mo><msqrt><msub><mi>ℐ</mi><mn>1</mn></msub></msqrt><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g_1(z;\theta) = \frac{d}{dz}P(Z_1\leq z) = \phi\left(z - \sqrt{\mathcal{I}_1}\theta(t_1)\right)\tag{2}</annotation></semantics></math></p>
<p>and for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mi>…</mi><mi>K</mi></mrow><annotation encoding="application/x-tex">k=2,3,\ldots K</annotation></semantics></math>
we recursively define the subdensity function</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>g</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mi>d</mi><mrow><mi>d</mi><mi>z</mi></mrow></mfrac><msub><mi>P</mi><mi>θ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>Z</mi><mi>k</mi></msub><mo>≤</mo><mi>z</mi><mo stretchy="false" form="postfix">}</mo><msubsup><mo>∩</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false" form="prefix">{</mo><msub><mi>a</mi><mi>j</mi></msub><mo>≤</mo><msub><mi>Z</mi><mi>j</mi></msub><mo>&lt;</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mo>∫</mo><msub><mi>a</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><msub><mi>b</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></msubsup><mfrac><mi>d</mi><mrow><mi>d</mi><mi>z</mi></mrow></mfrac><msub><mi>P</mi><mi>θ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>Z</mi><mi>k</mi></msub><mo>≤</mo><mi>z</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>Z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>g</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mo>∫</mo><msub><mi>a</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><msub><mi>b</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></msubsup><msub><mi>f</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>z</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>g</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
g_k(z; \theta) &amp;= \frac{d}{dz}P_\theta(\{Z_k\leq z\}\cap_{j=1}^{k-1}\{a_j\leq Z_j&lt;b_j\}) \\
 &amp;=\int_{a_{k-1}}^{b_{k-1}}\frac{d}{dz}P_\theta(\{Z_k\leq z |Z_{k-1}=z_{k-1}\})g_{k-1}(z_{k-1}; \theta)dz_{k-1}\\
 &amp;=\int_{a_{k-1}}^{b_{k-1}}f_k(z_{k-1},z;\theta)g_{k-1}(z_{k-1}; \theta)dz_{k-1}.\tag{3}
 \end{align}</annotation></semantics></math></p>
<p>The bottom line notation here is the same as on p. 347 in <span class="citation">Jennison and Turnbull (1999)</span>. However,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_k()</annotation></semantics></math>
here takes a slightly different form.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>f</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>z</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mi>d</mi><mrow><mi>d</mi><mi>z</mi></mrow></mfrac><msub><mi>P</mi><mi>θ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>Z</mi><mi>k</mi></msub><mo>≤</mo><mi>z</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>Z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mi>d</mi><mrow><mi>d</mi><mi>z</mi></mrow></mfrac><msub><mi>P</mi><mi>θ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>B</mi><mi>k</mi></msub><mo>−</mo><msub><mi>B</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>≤</mo><mi>z</mi><msqrt><msub><mi>t</mi><mi>k</mi></msub></msqrt><mo>−</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><msqrt><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></msqrt><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mi>d</mi><mrow><mi>d</mi><mi>z</mi></mrow></mfrac><mi>Φ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>z</mi><msqrt><msub><mi>t</mi><mi>k</mi></msub></msqrt><mo>−</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><msqrt><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></msqrt><mo>−</mo><msqrt><msub><mi>ℐ</mi><mi>K</mi></msub></msqrt><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msqrt><mrow><msub><mi>t</mi><mi>k</mi></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><msqrt><msub><mi>t</mi><mi>k</mi></msub></msqrt><msqrt><mrow><msub><mi>t</mi><mi>k</mi></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt></mfrac><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>z</mi><msqrt><msub><mi>t</mi><mi>k</mi></msub></msqrt><mo>−</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><msqrt><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></msqrt><mo>−</mo><msqrt><msub><mi>ℐ</mi><mi>K</mi></msub></msqrt><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msqrt><mrow><msub><mi>t</mi><mi>k</mi></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><msqrt><msub><mi>ℐ</mi><mi>k</mi></msub></msqrt><msqrt><mrow><msub><mi>ℐ</mi><mi>k</mi></msub><mo>−</mo><msub><mi>ℐ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt></mfrac><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>z</mi><msqrt><msub><mi>ℐ</mi><mi>k</mi></msub></msqrt><mo>−</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><msqrt><msub><mi>ℐ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></msqrt><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ℐ</mi><mi>k</mi></msub><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>ℐ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msqrt><mrow><msub><mi>ℐ</mi><mi>k</mi></msub><mo>−</mo><msub><mi>ℐ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
f_k(z_{k-1},z;\theta) &amp;=\frac{d}{dz}P_\theta(\{Z_k\leq z |Z_{k-1}=z_{k-1}\})\\
 &amp;=\frac{d}{dz}P_\theta(B_k - B_{k-1} \leq z\sqrt{t_k}-z_{k-1}\sqrt{t_{k-1}})\\
 &amp;=\frac{d}{dz}\Phi\left(\frac{z\sqrt{t_k}-z_{k-1}\sqrt{t_{k-1}}-\sqrt{\mathcal{I}_K}(t_k\theta(t_k)- t_{k-1}\theta(t_{k-1}))}{\sqrt{t_k-t_{k-1}}}\right)\\
 &amp;=\frac{\sqrt{t_k}}{\sqrt{t_k-t_{k-1}}}\phi\left(\frac{z\sqrt{t_k}-z_{k-1}\sqrt{t_{k-1}}-\sqrt{\mathcal{I}_K}(t_k\theta(t_k)- t_{k-1}\theta(t_{k-1}))}{\sqrt{t_k-t_{k-1}}}\right)\\
 &amp;=\frac{\sqrt{\mathcal{I}_k}}{\sqrt{\mathcal{I}_k-\mathcal{I}_{k-1}}}\phi\left(\frac{z\sqrt{\mathcal{I}_k}-z_{k-1}\sqrt{\mathcal{I}_{k-1}}-(\mathcal{I}_k\theta(t_k)- \mathcal{I}_{k-1}\theta(t_{k-1}))}{\sqrt{\mathcal{I}_k-\mathcal{I}_{k-1}}}\right).\tag{3}
\end{align}</annotation></semantics></math></p>
<p>We have worked towards this last line due to its comparability to
equation (19.4) on p. 347 of <span class="citation">Jennison and
Turnbull (1999)</span> which assumes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta(t_k)=\theta</annotation></semantics></math>
for some constant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>;
we re-write that equation slightly here as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>z</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><msqrt><msub><mi>ℐ</mi><mi>k</mi></msub></msqrt><msqrt><mrow><msub><mi>ℐ</mi><mi>k</mi></msub><mo>−</mo><msub><mi>ℐ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt></mfrac><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>z</mi><msqrt><msub><mi>ℐ</mi><mi>k</mi></msub></msqrt><mo>−</mo><msub><mi>z</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><msqrt><msub><mi>ℐ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></msqrt><mo>−</mo><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ℐ</mi><mi>k</mi></msub><mo>−</mo><msub><mi>ℐ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msqrt><mrow><msub><mi>ℐ</mi><mi>k</mi></msub><mo>−</mo><msub><mi>ℐ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">f_k(z_{k-1},z;\theta) = \frac{\sqrt{\mathcal{I}_k}}{\sqrt{\mathcal{I}_k-\mathcal{I}_{k-1}}}\phi\left(\frac{z\sqrt{\mathcal{I}_k}-z_{k-1}\sqrt{\mathcal{I}_{k-1}}-\theta(\mathcal{I}_k- \mathcal{I}_{k-1})}{\sqrt{\mathcal{I}_k-\mathcal{I}_{k-1}}}\right).\tag{4}</annotation></semantics></math>
This is really the only difference in the computational algorithm for
boundary crossing probabilities from the <span class="citation">Jennison
and Turnbull (1999)</span> algorithm. Using the above recursive approach
we can compute for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k=1,2,\ldots,K</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><msub><mi>b</mi><mi>k</mi></msub><mi>∞</mi></msubsup><msub><mi>g</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">\alpha_{k}(\theta)=\int_{b_k}^\infty g_k(z;\theta)dz\tag{5}</annotation></semantics></math>
and
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><msub><mi>a</mi><mi>k</mi></msub></msubsup><msub><mi>g</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>z</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">\beta_{k}(\theta)=\int_{-\infty}^{a_k} g_k(z;\theta)dz.\tag{6}</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="deriving-spending-boundaries">Deriving spending boundaries<a class="anchor" aria-label="anchor" href="#deriving-spending-boundaries"></a>
</h3>
<p>We can now derive boundaries satisfying given boundary crossing
probabilities using equations (2-6) above. Suppose for we have specified
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>b</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">b_1,\ldots,b_{k-1}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>a</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">a_1,\ldots,a_{k-1}</annotation></semantics></math>
and now wish to derive
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>k</mi></msub><annotation encoding="application/x-tex">a_k</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>k</mi></msub><annotation encoding="application/x-tex">b_k</annotation></semantics></math>
such that equations (5) and (6) hold. We write the upper bound as a
function of the probability of crossing we wish to derive.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mi>b</mi><mi>∞</mi></msubsup><msub><mi>g</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">\pi_k(b;\theta) = \int_b^\infty g_k(z;\theta)dz</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>π</mi><mi>k</mi><mi>′</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mi>d</mi><mrow><mi>d</mi><mi>b</mi></mrow></mfrac><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><msub><mi>g</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\pi_k^\prime(b;\theta) =\frac{d}{db}\pi_k(b;\theta)= -g_k(b; \theta).\tag{7}</annotation></semantics></math>
If we have a value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_k(b^{(i)};\theta)</annotation></semantics></math>
we can use a first order Taylor’s series expansion to approximate</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≈</mo><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>−</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>π</mi><mi>k</mi><mi>′</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_k(b;\theta)\approx \pi_k(b^{(i)};\theta)+(b-b^{(i)})\pi_k^\prime(b^{(i)};\theta)</annotation></semantics></math>
We set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">b^{(i+1)}</annotation></semantics></math>
such that</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>−</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>π</mi><mi>′</mi></msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\alpha_k(\theta)=\pi_k(b^{(i)}; \theta) + (b^{(i+1)}-b^{(i)})\pi^\prime(b^{(i)};\theta).</annotation></semantics></math></p>
<p>Solving for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">b^{(i+1)}</annotation></semantics></math>
we have</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>+</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>=</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>+</mo><mfrac><mrow><msub><mi>α</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msubsup><mi>π</mi><mi>k</mi><mi>′</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>=</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>−</mo><mfrac><mrow><msub><mi>α</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>g</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">b^{(i+i)} = b^{(i)} + \frac{\alpha_k(\theta) - \pi_k(b^{(i)};\theta)}{\pi_k^\prime(b^{(i)}; \theta)}= b^{(i)} - \frac{\alpha_k(\theta) - \pi_k(b^{(i)};\theta)}{g_k(b^{(i)}; \theta)}\tag{8}</annotation></semantics></math>
and iterate until
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>−</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">|</mo></mrow><mo>&lt;</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">|b^{(i+1)}-b^{(i)}|&lt;\epsilon</annotation></semantics></math>
for some tolerance level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\epsilon&gt;0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>α</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_k(b^{(i+1)};\theta)-\alpha_k(\theta)</annotation></semantics></math>
is suitably small. A simple starting value for any
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>=</mo><msup><mi>Φ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>α</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msqrt><msub><mi>ℐ</mi><mi>k</mi></msub></msqrt><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">b^{(0)} = \Phi^{-1}(1- \alpha_k(\theta)) + \sqrt{\mathcal{I}_k}\theta(t_k).\tag{9}</annotation></semantics></math>
Normally,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>k</mi></msub><annotation encoding="application/x-tex">b_k</annotation></semantics></math>
will be calculated with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\theta(t_k)=0</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k=1,2,\ldots,K</annotation></semantics></math>
which simplifies the above. However,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>k</mi></msub><annotation encoding="application/x-tex">a_k</annotation></semantics></math>
computed analogously will often use a non-zero
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
to enable so-called
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>-spending.</p>
</div>
<div class="section level3">
<h3 id="numerical-integration">Numerical integration<a class="anchor" aria-label="anchor" href="#numerical-integration"></a>
</h3>
<p>The numerical integration required to compute boundary probabilities
and derive boundaries is the same as that defined in section 19.3 of
<span class="citation">Jennison and Turnbull (1999)</span>. The single
change is the replacement of the non-proportional effect size assumption
of equation (3) above replacing the equivalent of equation (4) used for
a constant effect size as in <span class="citation">Jennison and
Turnbull (1999)</span>.</p>
<div class="section level4">
<h4 id="demonstrating-calculations">Demonstrating calculations<a class="anchor" aria-label="anchor" href="#demonstrating-calculations"></a>
</h4>
<p>We walk through how to perform the basic calculations above. The
basic scenario will have one interim analysis in addition to the final
analysis. We will target Type I error
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.025</mn></mrow><annotation encoding="application/x-tex">\alpha=0.025</annotation></semantics></math>
and Type II error
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\beta = 0.1</annotation></semantics></math>,
the latter corresponding to a target of 90% power. We will assume a
power spending function with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\rho=2</annotation></semantics></math>
for both bounds. That is, for information fraction
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
the cumulative spending will be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>×</mo><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\alpha \times t^2</annotation></semantics></math>
for the upper bound and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>×</mo><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\beta \times t^2</annotation></semantics></math>
for the lower bound. Statistical information will be 1 for the first
analysis and 4 for the final analysis, leading to information fraction
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mn>1</mn><mi>/</mi><mn>4</mn><mo>,</mo><msub><mi>t</mi><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_1= 1/4, t_2=1</annotation></semantics></math>
for the interim and final, respectively. We assume
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>=</mo><mn>.5</mn></mrow><annotation encoding="application/x-tex">\theta_1 = .5</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>3</mn></msub><mo>=</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">\theta_3=1.5</annotation></semantics></math>.</p>
<ul>
<li>Set up overall study parameters</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Information for both null and alternative</span></span>
<span><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># information fraction</span></span>
<span><span class="va">timing</span> <span class="op">&lt;-</span> <span class="va">info</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span></span>
<span><span class="co"># Type I error</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.025</span></span>
<span><span class="co"># Type II error (1 - power)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="co"># Cumulative alpha-spending at IA, Final</span></span>
<span><span class="va">alphaspend</span> <span class="op">&lt;-</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">timing</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="co"># Cumulative beta-spending at IA, Final</span></span>
<span><span class="va">betaspend</span> <span class="op">&lt;-</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">timing</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="co"># Average treatment effect at analyses</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span></code></pre></div>
<ul>
<li>Calculate interim bounds</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Upper bound under null hypothesis</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">alphaspend</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Lower bound under alternate hypothesis</span></span>
<span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">betaspend</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Compare probability of crossing vs target for bounds:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Upper bound ="</span>, <span class="va">b1</span>, <span class="st">"Target spend ="</span>, <span class="va">alphaspend</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Actual spend ="</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">b1</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Upper bound = 2.955167 Target spend = 0.0015625 Actual spend = 0.0015625</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Lower bound under alternate hypothesis</span></span>
<span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">betaspend</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Compare probability of crossing vs target for bounds:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Lower bound ="</span>, <span class="va">a1</span>, <span class="st">"Target spend ="</span>, <span class="va">betaspend</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Actual spend ="</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">a1</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Lower bound = -1.997705 Target spend = 0.00625 Actual spend = 0.00625</span></span></code></pre></div>
<ul>
<li>Set up numerical integration grid for next (final) analysis</li>
</ul>
<p>We set up a table for numerical integration over the continuation
region which we can subsequently use to compute boundary crossing
probabilities for bounds at the second interim analysis. We begin with
the null hypothesis. The columns in the resulting table are -
<code>z</code> -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>-values
for the grid; recall that each interim test statistic is normally
distributed with variance 1 - <code>w</code> - weights for numerical
integration - <code>h</code> - weights <code>w</code> times the normal
density that can be used for numerical integration; we will demonstrate
use below</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up grid over continuation region</span></span>
<span><span class="co"># Null hypothesis</span></span>
<span><span class="va">grid1_0</span> <span class="op">&lt;-</span> <span class="fu">gsDesign2</span><span class="fu">:::</span><span class="fu">h1</span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">0</span>, info <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, a <span class="op">=</span> <span class="va">a1</span>, b <span class="op">=</span> <span class="va">b1</span><span class="op">)</span></span>
<span><span class="va">grid1_0</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $z</span></span>
<span><span class="co">#&gt;   [1] -1.99770547 -1.95718607 -1.91666667 -1.87500000 -1.83333333 -1.79166667</span></span>
<span><span class="co">#&gt;   [7] -1.75000000 -1.70833333 -1.66666667 -1.62500000 -1.58333333 -1.54166667</span></span>
<span><span class="co">#&gt;  [13] -1.50000000 -1.45833333 -1.41666667 -1.37500000 -1.33333333 -1.29166667</span></span>
<span><span class="co">#&gt;  [19] -1.25000000 -1.20833333 -1.16666667 -1.12500000 -1.08333333 -1.04166667</span></span>
<span><span class="co">#&gt;  [25] -1.00000000 -0.95833333 -0.91666667 -0.87500000 -0.83333333 -0.79166667</span></span>
<span><span class="co">#&gt;  [31] -0.75000000 -0.70833333 -0.66666667 -0.62500000 -0.58333333 -0.54166667</span></span>
<span><span class="co">#&gt;  [37] -0.50000000 -0.45833333 -0.41666667 -0.37500000 -0.33333333 -0.29166667</span></span>
<span><span class="co">#&gt;  [43] -0.25000000 -0.20833333 -0.16666667 -0.12500000 -0.08333333 -0.04166667</span></span>
<span><span class="co">#&gt;  [49]  0.00000000  0.04166667  0.08333333  0.12500000  0.16666667  0.20833333</span></span>
<span><span class="co">#&gt;  [55]  0.25000000  0.29166667  0.33333333  0.37500000  0.41666667  0.45833333</span></span>
<span><span class="co">#&gt;  [61]  0.50000000  0.54166667  0.58333333  0.62500000  0.66666667  0.70833333</span></span>
<span><span class="co">#&gt;  [67]  0.75000000  0.79166667  0.83333333  0.87500000  0.91666667  0.95833333</span></span>
<span><span class="co">#&gt;  [73]  1.00000000  1.04166667  1.08333333  1.12500000  1.16666667  1.20833333</span></span>
<span><span class="co">#&gt;  [79]  1.25000000  1.29166667  1.33333333  1.37500000  1.41666667  1.45833333</span></span>
<span><span class="co">#&gt;  [85]  1.50000000  1.54166667  1.58333333  1.62500000  1.66666667  1.70833333</span></span>
<span><span class="co">#&gt;  [91]  1.75000000  1.79166667  1.83333333  1.87500000  1.91666667  1.95833333</span></span>
<span><span class="co">#&gt;  [97]  2.00000000  2.04166667  2.08333333  2.12500000  2.16666667  2.20833333</span></span>
<span><span class="co">#&gt; [103]  2.25000000  2.29166667  2.33333333  2.37500000  2.41666667  2.45833333</span></span>
<span><span class="co">#&gt; [109]  2.50000000  2.54166667  2.58333333  2.62500000  2.66666667  2.70833333</span></span>
<span><span class="co">#&gt; [115]  2.75000000  2.79166667  2.83333333  2.87500000  2.91666667  2.93591676</span></span>
<span><span class="co">#&gt; [121]  2.95516685</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $w</span></span>
<span><span class="co">#&gt;   [1] 0.013506468 0.054025872 0.027395357 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;   [7] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [13] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [19] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [25] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [31] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [37] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [43] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [49] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [55] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [61] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [67] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [73] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [79] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [85] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [91] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt;  [97] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt; [103] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt; [109] 0.027777778 0.055555556 0.027777778 0.055555556 0.027777778 0.055555556</span></span>
<span><span class="co">#&gt; [115] 0.027777778 0.055555556 0.027777778 0.055555556 0.020305586 0.025666787</span></span>
<span><span class="co">#&gt; [121] 0.006416697</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $h</span></span>
<span><span class="co">#&gt;   [1] 7.325795e-04 3.174772e-03 1.741296e-03 3.821460e-03 2.064199e-03</span></span>
<span><span class="co">#&gt;   [6] 4.452253e-03 2.396592e-03 5.151272e-03 2.763254e-03 5.918793e-03</span></span>
<span><span class="co">#&gt;  [11] 3.163964e-03 6.753608e-03 3.597711e-03 7.652841e-03 4.062610e-03</span></span>
<span><span class="co">#&gt;  [16] 8.611793e-03 4.555835e-03 9.623842e-03 5.073586e-03 1.068040e-02</span></span>
<span><span class="co">#&gt;  [21] 5.611075e-03 1.177092e-02 6.162560e-03 1.288302e-02 6.721409e-03</span></span>
<span><span class="co">#&gt;  [26] 1.400261e-02 7.280204e-03 1.511417e-02 7.830885e-03 1.620106e-02</span></span>
<span><span class="co">#&gt;  [31] 8.364929e-03 1.724594e-02 8.873556e-03 1.823116e-02 9.347967e-03</span></span>
<span><span class="co">#&gt;  [36] 1.913930e-02 9.779592e-03 1.995361e-02 1.016034e-02 2.065862e-02</span></span>
<span><span class="co">#&gt;  [41] 1.048287e-02 2.124051e-02 1.074078e-02 2.168766e-02 1.092888e-02</span></span>
<span><span class="co">#&gt;  [46] 2.199098e-02 1.104332e-02 2.214423e-02 1.108173e-02 2.214423e-02</span></span>
<span><span class="co">#&gt;  [51] 1.104332e-02 2.199098e-02 1.092888e-02 2.168766e-02 1.074078e-02</span></span>
<span><span class="co">#&gt;  [56] 2.124051e-02 1.048287e-02 2.065862e-02 1.016034e-02 1.995361e-02</span></span>
<span><span class="co">#&gt;  [61] 9.779592e-03 1.913930e-02 9.347967e-03 1.823116e-02 8.873556e-03</span></span>
<span><span class="co">#&gt;  [66] 1.724594e-02 8.364929e-03 1.620106e-02 7.830885e-03 1.511417e-02</span></span>
<span><span class="co">#&gt;  [71] 7.280204e-03 1.400261e-02 6.721409e-03 1.288302e-02 6.162560e-03</span></span>
<span><span class="co">#&gt;  [76] 1.177092e-02 5.611075e-03 1.068040e-02 5.073586e-03 9.623842e-03</span></span>
<span><span class="co">#&gt;  [81] 4.555835e-03 8.611793e-03 4.062610e-03 7.652841e-03 3.597711e-03</span></span>
<span><span class="co">#&gt;  [86] 6.753608e-03 3.163964e-03 5.918793e-03 2.763254e-03 5.151272e-03</span></span>
<span><span class="co">#&gt;  [91] 2.396592e-03 4.452253e-03 2.064199e-03 3.821460e-03 1.765603e-03</span></span>
<span><span class="co">#&gt;  [96] 3.257338e-03 1.499749e-03 2.757277e-03 1.265110e-03 2.317833e-03</span></span>
<span><span class="co">#&gt; [101] 1.059795e-03 1.934941e-03 8.816570e-04 1.604123e-03 7.283858e-04</span></span>
<span><span class="co">#&gt; [106] 1.320661e-03 5.975956e-04 1.079765e-03 4.868972e-04 8.767006e-04</span></span>
<span><span class="co">#&gt; [111] 3.939593e-04 7.068990e-04 3.165552e-04 5.660405e-04 2.525990e-04</span></span>
<span><span class="co">#&gt; [116] 4.501131e-04 2.001694e-04 3.554511e-04 1.151506e-04 1.375807e-04</span></span>
<span><span class="co">#&gt; [121] 3.249917e-05</span></span></code></pre></div>
<p>The probability of not crossing a bound under the null hypothesis is
computed as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob_h0_continue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">grid1_0</span><span class="op">$</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Probability of continuing trial under null hypothesis\n"</span>,</span>
<span>  <span class="st">" Using numerical integration:"</span>, <span class="va">prob_h0_continue</span>,</span>
<span>  <span class="st">"\n  Using normal CDF:"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">b1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">a1</span><span class="op">)</span>, <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Probability of continuing trial under null hypothesis</span></span>
<span><span class="co">#&gt;   Using numerical integration: 0.9755632 </span></span>
<span><span class="co">#&gt;   Using normal CDF: 0.9755632</span></span></code></pre></div>
<p>We now set up numerical integration grid under the alternate
hypothesis and the compute continuation probability.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid1_1</span> <span class="op">&lt;-</span> <span class="fu">gsDesign2</span><span class="fu">:::</span><span class="fu">h1</span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, info <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, a <span class="op">=</span> <span class="va">a1</span>, b <span class="op">=</span> <span class="va">b1</span><span class="op">)</span></span>
<span><span class="va">prob_h1_continue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">grid1_1</span><span class="op">$</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="va">h1mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Probability of continuing trial under alternate hypothesis\n"</span>,</span>
<span>  <span class="st">" Using numerical integration:"</span>, <span class="va">prob_h1_continue</span>,</span>
<span>  <span class="st">"\n  Using normal CDF:"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">b1</span>, mean <span class="op">=</span> <span class="va">h1mean</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">a1</span>, <span class="va">h1mean</span><span class="op">)</span>, <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Probability of continuing trial under alternate hypothesis</span></span>
<span><span class="co">#&gt;   Using numerical integration: 0.986709 </span></span>
<span><span class="co">#&gt;   Using normal CDF: 0.986709</span></span></code></pre></div>
<ul>
<li>Compute initial iteration for analysis 2 bounds</li>
</ul>
<p>The initial estimate of the second analysis bounds are computed the
same way as the actual first analysis bounds.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Upper bound under null hypothesis</span></span>
<span><span class="co"># incremental spend</span></span>
<span><span class="va">spend0</span> <span class="op">&lt;-</span> <span class="va">alphaspend</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">alphaspend</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># H0 bound at 2nd analysis; 1st approximation</span></span>
<span><span class="va">b2_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">spend0</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Lower bound under alternate hypothesis</span></span>
<span><span class="va">spend1</span> <span class="op">&lt;-</span> <span class="va">betaspend</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">betaspend</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">a2_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">spend1</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">info</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Initial bound approximation for 2nd analysis\n ("</span>,</span>
<span>  <span class="va">a2_0</span>, <span class="st">", "</span>, <span class="va">b2_0</span>, <span class="st">")\n"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">""</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Initial bound approximation for 2nd analysis</span></span>
<span><span class="co">#&gt;  (1.681989, 1.987428)</span></span></code></pre></div>
<ul>
<li>Compute actual boundary crossing probabilities with initial
approximations</li>
</ul>
<p>To get actual boundary crossing probabilities at the second analysis,
we update our numerical integration grids. Under the null hypothesis, we
need to update to the interval above <code>b2_0</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Upper rejection region grid under H0</span></span>
<span><span class="va">grid2_0</span> <span class="op">&lt;-</span> <span class="fu">gsDesign2</span><span class="fu">:::</span><span class="fu">hupdate</span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">0</span>, info <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, a <span class="op">=</span> <span class="va">b2_0</span>, b <span class="op">=</span> <span class="cn">Inf</span>, im1 <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gm1 <span class="op">=</span> <span class="va">grid1_0</span><span class="op">)</span></span>
<span><span class="va">pupper_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">grid2_0</span><span class="op">$</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Upper spending at analysis 2\n Target:"</span>, <span class="va">spend0</span>, <span class="st">"\n Using initial bound approximation:"</span>,</span>
<span>  <span class="va">pupper_0</span>, <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Upper spending at analysis 2</span></span>
<span><span class="co">#&gt;  Target: 0.0234375 </span></span>
<span><span class="co">#&gt;  Using initial bound approximation: 0.02290683</span></span></code></pre></div>
<p>To get a first order Taylor’s series approximation to update this
bound, we need the derivative of the above probability with respect to
the Z-value cutoff. This was given above as the subdensity computed in
the grid. As before, the grid contains the numerical integration weight
in <code>w</code> and that weight times the subdensity in
<code>h</code>. Thus, to get the subdensity at the bound, which is the
estimated derivative in the boundary crossing probability, we
compute:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First point in grid is at bound</span></span>
<span><span class="co"># Compute derivative</span></span>
<span><span class="va">dpdb2</span> <span class="op">&lt;-</span> <span class="va">grid2_0</span><span class="op">$</span><span class="va">h</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">grid2_0</span><span class="op">$</span><span class="va">w</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Compute difference between target and actual bound crossing probability</span></span>
<span><span class="va">pdiff</span> <span class="op">&lt;-</span> <span class="va">spend0</span> <span class="op">-</span> <span class="va">pupper_0</span></span>
<span><span class="co"># Taylor's series update</span></span>
<span><span class="va">b2_1</span> <span class="op">&lt;-</span> <span class="va">b2_0</span> <span class="op">-</span> <span class="va">pdiff</span> <span class="op">/</span> <span class="va">dpdb2</span></span>
<span><span class="co"># Compute boundary crossing probability at updated bound</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Original bound approximation:"</span>, <span class="va">b2_0</span>,</span>
<span>  <span class="st">"\nUpdated bound approximation:"</span>, <span class="va">b2_1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Original bound approximation: 1.987428 </span></span>
<span><span class="co">#&gt; Updated bound approximation: 1.977726</span></span>
<span><span class="va">grid2_0</span> <span class="op">&lt;-</span> <span class="fu">gsDesign2</span><span class="fu">:::</span><span class="fu">hupdate</span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">0</span>, info <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, a <span class="op">=</span> <span class="va">b2_1</span>, b <span class="op">=</span> <span class="cn">Inf</span>, im1 <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gm1 <span class="op">=</span> <span class="va">grid1_0</span><span class="op">)</span></span>
<span><span class="va">pupper_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">grid2_0</span><span class="op">$</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"\nOriginal boundary crossing probability:"</span>, <span class="va">pupper_0</span>,</span>
<span>  <span class="st">"\nUpdated boundary crossing probability:"</span>, <span class="va">pupper_1</span>,</span>
<span>  <span class="st">"\nTarget:"</span>, <span class="va">spend0</span>, <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Original boundary crossing probability: 0.02290683 </span></span>
<span><span class="co">#&gt; Updated boundary crossing probability: 0.02344269 </span></span>
<span><span class="co">#&gt; Target: 0.0234375</span></span></code></pre></div>
<p>We see that the Taylor’s series update has gotten us substantially
closer to the targeted boundary probability. We now update the lower
bound in an analogous fashion.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Lower rejection region grid under H1</span></span>
<span><span class="va">grid2_1</span> <span class="op">&lt;-</span> <span class="fu">gsDesign2</span><span class="fu">:::</span><span class="fu">hupdate</span><span class="op">(</span></span>
<span>  theta <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, info <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, a <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, b <span class="op">=</span> <span class="va">a2_0</span>,</span>
<span>  thetam1 <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, im1 <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gm1 <span class="op">=</span> <span class="va">grid1_1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plower_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">grid2_1</span><span class="op">$</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="co"># Last point in grid is at bound</span></span>
<span><span class="co"># Compute derivative</span></span>
<span><span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grid2_1</span><span class="op">$</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="va">dpda2</span> <span class="op">&lt;-</span> <span class="va">grid2_1</span><span class="op">$</span><span class="va">h</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span> <span class="op">/</span> <span class="va">grid2_1</span><span class="op">$</span><span class="va">w</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span></span>
<span><span class="co"># Compute difference between target and actual bound crossing probability</span></span>
<span><span class="va">pdiff</span> <span class="op">&lt;-</span> <span class="va">spend1</span> <span class="op">-</span> <span class="va">plower_0</span></span>
<span><span class="co"># Taylor's series update</span></span>
<span><span class="va">a2_1</span> <span class="op">&lt;-</span> <span class="va">a2_0</span> <span class="op">+</span> <span class="va">pdiff</span> <span class="op">/</span> <span class="va">dpda2</span></span>
<span><span class="co"># Compute boundary crossing probability at updated bound</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Original bound approximation:"</span>, <span class="va">a2_0</span>,</span>
<span>  <span class="st">"\nUpdated bound approximation:"</span>, <span class="va">a2_1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Original bound approximation: 1.681989 </span></span>
<span><span class="co">#&gt; Updated bound approximation: 1.702596</span></span>
<span></span>
<span><span class="va">grid2_1</span> <span class="op">&lt;-</span> <span class="fu">gsDesign2</span><span class="fu">:::</span><span class="fu">hupdate</span><span class="op">(</span></span>
<span>  theta <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, info <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, a <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, b <span class="op">=</span> <span class="va">a2_1</span>,</span>
<span>  thetam1 <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, im1 <span class="op">=</span> <span class="va">info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gm1 <span class="op">=</span> <span class="va">grid1_1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plower_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">grid2_1</span><span class="op">$</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"\nOriginal boundary crossing probability:"</span>, <span class="va">plower_0</span>,</span>
<span>  <span class="st">"\nUpdated boundary crossing probability:"</span>, <span class="va">plower_1</span>,</span>
<span>  <span class="st">"\nTarget:"</span>, <span class="va">spend1</span>, <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Original boundary crossing probability: 0.09035972 </span></span>
<span><span class="co">#&gt; Updated boundary crossing probability: 0.09379707 </span></span>
<span><span class="co">#&gt; Target: 0.09375</span></span></code></pre></div>
<ul>
<li>Confirm with <code><a href="../reference/gs_power_npe.html">gs_power_npe()</a></code>
</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gs_power_npe.html">gs_power_npe</a></span><span class="op">(</span></span>
<span>  theta <span class="op">=</span> <span class="va">theta</span>, theta1 <span class="op">=</span> <span class="va">theta</span>, info <span class="op">=</span> <span class="va">info</span>, binding <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  upper <span class="op">=</span> <span class="va">gs_spending_bound</span>,</span>
<span>  upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://keaven.github.io/gsDesign/reference/sfPower.html" class="external-link">sfPower</a></span>, total_spend <span class="op">=</span> <span class="fl">0.025</span>, param <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="va">gs_spending_bound</span>,</span>
<span>  lpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://keaven.github.io/gsDesign/reference/sfPower.html" class="external-link">sfPower</a></span>, total_spend <span class="op">=</span> <span class="fl">0.1</span>, param <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 10</span></span></span>
<span><span class="co">#&gt;   analysis bound     z probability theta theta1 info_frac  info info0 info1</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1 upper  2.96     0.007<span style="text-decoration: underline;">04</span>   0.5    0.5      0.25     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        2 upper  1.98     0.845     1.5    1.5      1        4     4     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        1 lower -<span style="color: #BB0000;">2.00</span>     0.006<span style="text-decoration: underline;">25</span>   0.5    0.5      0.25     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        2 lower  1.70     0.100     1.5    1.5      1        4     4     4</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-jennison1999group" class="csl-entry">
Jennison, Christopher, and Bruce W Turnbull. 1999. <em>Group Sequential
Methods with Applications to Clinical Trials</em>. Chapman &amp;
Hall/CRC.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaven Anderson, Yilong Zhang, Yujie Zhao, Jianxiao Yang, Nan Xiao. Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0. <br>Copyright © 2024 Merck &amp; Co., Inc., Rahway, NJ, USA and its affiliates. All rights reserved.</p>
</div>

<div class="pkgdown-footer-right">
  <p><span></span></p>
</div>

    </footer>
</div>





  </body>
</html>
