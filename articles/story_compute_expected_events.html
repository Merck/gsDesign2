<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gsDesign2">
<title>Computing expected events by interval at risk • gsDesign2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Computing expected events by interval at risk">
<meta property="og:description" content="gsDesign2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gsDesign2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/LittleBeannie/gsDesign2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="story_compute_expected_events_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="story_compute_expected_events_files/kePrint-0.0.1/kePrint.js"></script><link href="story_compute_expected_events_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Computing expected events by interval at risk</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LittleBeannie/gsDesign2/blob/HEAD/vignettes/story_compute_expected_events.Rmd" class="external-link"><code>vignettes/story_compute_expected_events.Rmd</code></a></small>
      <div class="d-none name"><code>story_compute_expected_events.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document derives an algorithm for computing expected events observed for a model with piecewise constant enrollment, failure and dropout rates similar to <span class="citation">Lachin and Foulkes (1986)</span>. Specifically, we design this to enable computation of an <em>average hazard ratio</em> which we will use elsewhere to approximate sample size for fixed or group sequential designs under a non-proportional hazards assumption (<span class="citation">Kalbfleisch and Prentice (1981)</span>, <span class="citation">Schemper, Wakounig, and Heinze (2009)</span>). The expected events calculation outlined here is implemented in the function <code><a href="../reference/eEvents_df.html">eEvents_df()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="general-formulation-and-notation">General formulation and notation<a class="anchor" aria-label="anchor" href="#general-formulation-and-notation"></a>
</h2>
<p>For notation, the study time scale will denoted with <span class="math inline">\(\omega\)</span> with the study start first opening for enrollment at <span class="math inline">\(\omega=0\)</span>. We will use the variable <span class="math inline">\(t\)</span> to indicate patient time with <span class="math inline">\(t=0\)</span> representing the time a patient is enrolled. We assume the patient time from enrollment to an event is independent and identically distributed for all subjects enrolled. We also assume the patient time of censoring is independent and identically distributed for all subjects enrolled. For an individual, let <span class="math inline">\(X&gt;0\)</span> denote the patient time until an event and <span class="math inline">\(Y&gt;0\)</span> denote the patient time until loss-to-follow-up. We also let <span class="math inline">\(U\)</span> denote the (independent) study time of entry for the patient. We assume the triplet <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span>, <span class="math inline">\(U\)</span> are independent.</p>
<p>We will consider a single treatment group and stratum and assume subjects enroll according to a Poisson process with entry rate <span class="math inline">\(g(\omega)\geq 0\)</span> for <span class="math inline">\(0\le \omega\)</span>. The expected number of subjects enrolled by study time <span class="math inline">\(\omega\)</span> is simply</p>
<p><span class="math display">\[\begin{equation}
G(\omega)=\int_0^\omega g(u)du.
\end{equation}\]</span></p>
<p>Analysis of time-to-event data is done using the time from enrollment until the patient has an event, drops out, or is censored prior having an event at the time of a data cutoff; we will consider the data cutoff to be fixed at time <span class="math inline">\(\Omega\)</span>. The key counts we consider here is:</p>
<ul>
<li>
<span class="math inline">\(\bar{N}(t)\)</span> : the number of patients with events at or before being on study for at least a duration <span class="math inline">\(0&lt;t \le \Omega\)</span> at time of data cutoff at study time <span class="math inline">\(\Omega\)</span>.</li>
<li>
<span class="math inline">\(\bar{n}(t_1,t_2)\equiv E\{\bar{N}(t_2)-\bar{N}(t_1)\}\)</span> : the number of patients with events in the interval <span class="math inline">\((t_1,t_2]\)</span>, <span class="math inline">\(0\le t_1&lt; t_2\le \Omega\)</span>.</li>
</ul>
<p>We will focus on the the expected value of <span class="math inline">\(\bar{n}(t_1,t_2)\)</span> due to its usefulness in computing an average hazard ratio under the piecewise model outlined below. For a patient to be in the count <span class="math inline">\(\bar{n}(t_1,t_2)\)</span> they must be enrolled prior to time <span class="math inline">\(\Omega - t_1\)</span>. Also, for a patient enrolled at time <span class="math inline">\(0&lt;u&lt;\Omega\)</span> the maximum time they would be observed for occurrence of an event would be <span class="math inline">\(\Omega - u\)</span>. Thus, <span class="math display">\[\begin{align}
E\{\bar{n}(t_1,t_2)\}&amp;=\int_0^{\Omega-{t_1}} g(u) 
P\{t_1&lt;X\leq \min(t_2,\Omega-u), X\leq Y\} du\nonumber\\
&amp;=\int_0^{\Omega-t_2} g(u) P\{t_1&lt;X\leq t_2, X\leq Y\} du+ \int_{\Omega-t_2}^{\Omega-t_1} g(u) P\{t_1&lt; X\leq \Omega-u, X\leq Y\} du\nonumber\\
&amp;=G(\Omega-t_2)P\{t_1&lt;X\leq t_2, X\leq Y\}+ 
\int_{\Omega-t_2}^{\Omega-t_1} g(u) P\{t_1&lt; X\leq \Omega-u, X\leq Y\} du.\nonumber
\end{align}\]</span></p>
</div>
<div class="section level2">
<h2 id="the-piecewise-model">The piecewise model<a class="anchor" aria-label="anchor" href="#the-piecewise-model"></a>
</h2>
<p>The model here is as follows:</p>
<ul>
<li>Piecewise constant enrollment rates are allowed given that the enrollment rate often accelerates early in the trial.</li>
<li>Piecewise exponential failure rates are allowed to allow changing outcome incidence over time.</li>
<li>Piecewise exponential censoring rates allow changing dropout rates over time.</li>
<li>A fixed study duration.</li>
</ul>
<p><span class="citation">Lachin and Foulkes (1986)</span> have provided a general formulation for calculating the expected number of events over time in the scenario described above. However, we alter their algorithm to compute the expected number of events <span class="math inline">\(E\{\bar n(t_1,t_2)\}\)</span> in each follow-up period with a constant failure rate; this will later enable computing an average hazard ratio (<span class="citation">Kalbfleisch and Prentice (1981)</span>, <span class="citation">Schemper, Wakounig, and Heinze (2009)</span>).</p>
<p>We define a piecewise time-to-event and dropout random variables on the patient time scale. We assume <span class="math inline">\(0=t_0&lt;t_1&lt;...&lt;t_M=\infty\)</span> and for <span class="math inline">\(m=1,2,\ldots,M\)</span>. For <span class="math inline">\(m=1,2,\ldots,M\)</span>, we assume <span class="math inline">\(X_m&gt;0\)</span>, <span class="math inline">\(Y_m&gt;0\)</span> are random variables that are independent of the study entry time <span class="math inline">\(U\)</span>. We let <span class="math inline">\(X_m\)</span> and <span class="math inline">\(Y_m\)</span> define <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, respectively, on the interval <span class="math inline">\((t_{m-1},t_m]\)</span>, <span class="math inline">\(m=1,2,\ldots,M\)</span>, as follows:</p>
<p><span class="math display">\[\begin{align}
X&amp;=\sum_{m=1}^M \min(X_m,t_m-t_{m-1}) \prod_{j=1}^{m-1}I\{X_j&gt;t_j-t_{j-1}\}\label{eq:Xdef}\\
Y&amp;=\sum_{m=1}^M \min(Y_m,t_m-t_{m-1})\prod_{j=1}^{m-1}I\{Y_j&gt;t_j-t_{j-1}\}\label{eq:Ydef}.
\end{align}\]</span></p>
<p>Here assume that <span class="math inline">\(X_m\)</span> and <span class="math inline">\(Y_m\)</span> are independent and exponentially distributed with failure rates <span class="math inline">\(\lambda_m\)</span> and <span class="math inline">\(\eta_m\)</span>, respectively, <span class="math inline">\(m=1,2,\ldots,M\)</span>.</p>
<p>We now assume subjects enroll at a constant rate in each of <span class="math inline">\(J\)</span> intervals defined by <span class="math inline">\(0=\omega_0&lt;\omega_1&lt;\ldots&lt;\omega_J&lt;\infty\)</span>. We denote the enrollment rates by<br><span class="math display">\[\begin{equation}g(\omega)=\gamma_j\geq 0\label{eq:gj}\end{equation}\]</span> for <span class="math inline">\(\omega\)</span> in the interval <span class="math inline">\((\omega_{j-1},\omega_j]\)</span>, <span class="math inline">\(j=0,1,2,\ldots,J\)</span>. We assume <span class="math inline">\(\gamma_1&gt;0\)</span>, but for <span class="math inline">\(j&gt;1\)</span> we assume <span class="math inline">\(\gamma_j\ge 0\)</span>. Letting <span class="math inline">\(G_0=0\)</span> we recursively define for <span class="math inline">\(j=1,\ldots,J\)</span></p>
<p><span class="math display">\[\begin{equation}G_j=G(\omega_j)=G_{j-1}+\gamma_j(\omega_j-\omega_{j-1})\label{eq:Gj}\end{equation}\]</span> and thus for <span class="math inline">\(\omega\in [\omega_{j-1},\omega_j]\)</span> that the expected enrollment by study time <span class="math inline">\(\omega\)</span> is <span class="math display">\[\begin{equation}G(\omega)=G_{j-1}+\gamma_j(\omega-\omega_{j-1}).\label{eq:ENpw}\end{equation}\]</span></p>
<div class="section level3">
<h3 id="an-example-under-the-piecewise-model">An example under the piecewise model<a class="anchor" aria-label="anchor" href="#an-example-under-the-piecewise-model"></a>
</h3>
<p>We consider an example of this piecewise model assuming <span class="math inline">\(J=3\)</span>, <span class="math inline">\(\omega_j=1,2,7\)</span> and <span class="math inline">\(\gamma_j=3,2,0\)</span> for <span class="math inline">\(j=1,2,3\)</span>. We assume <span class="math inline">\(M=2\)</span> with <span class="math inline">\(t_m=4,\infty\)</span>, failure rates <span class="math inline">\(\lambda_m=.03,.06\)</span>, and dropout rates <span class="math inline">\(\eta_m=0.001,.002\)</span>. We plot all of these in the following plot with the enrollment rate axis on the right and the failure and dropout rate axis on the left. We plot <span class="math inline">\(\omega\)</span> in reverse order which is related to the integration in the equation for <span class="math inline">\(E\{\bar{n}(t_1,t_2)\}\)</span> above. We have also plotted a vertical dot-dashed line at each point where either the enrollment rate or a failure (and dropout) rate changes.</p>
<p><img src="story_compute_expected_events_files/figure-html/unnamed-chunk-2-1.png" width="624"></p>
</div>
<div class="section level3">
<h3 id="organizing-calculations-under-the-piecewise-model">Organizing calculations under the piecewise model<a class="anchor" aria-label="anchor" href="#organizing-calculations-under-the-piecewise-model"></a>
</h3>
<p>We now proceed to define algorithms for computing expected events observed in an interval for the model with piecewise constant enrollment, failure rates, and dropout rates. We assume study duration is <span class="math inline">\(\Omega=t_M\)</span>. We assume without loss of generality a sequence <span class="math inline">\(t_m\)</span>, <span class="math inline">\(m=1,2,\ldots, M\)</span> such that there is a constant failure rate <span class="math inline">\(\lambda_m\)</span> and dropout rate <span class="math inline">\(\eta_m\)</span> in the interval <span class="math inline">\((t_{m-1},t_m]\)</span> as well as a constant enrollment rate <span class="math inline">\(\gamma_m\)</span> in the interval <span class="math inline">\((t_M-t_m,t_M-t_{m-1}]\)</span>. Deriving the intervals is relatively a straightforward exercise as shown in the example above. For example, for the example above, the change points are where the vertical lines are drawn and we have the following scenario for calculation purposes.</p>
<table class="table table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Failure and dropout rates
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Enrollment rates
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
<span class="math inline">\(m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(t_m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\lambda_m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\eta_m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(j\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\omega_j\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\gamma_j\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>We define for <span class="math inline">\(m=1,\ldots,M\)</span> intermediate probability calculations for use in calculating <span class="math inline">\(\bar n(t_{m-1},t_m)\)</span> as follows:</p>
<p><span class="math display">\[\begin{align}
q_m&amp;=P\{\min(X_m,Y_m)&gt;t_m-t_{m-1}\}=\exp^{-(\lambda_m+\eta_m)(t_m-t_{m-1})} \label{eq:qm}\\
Q_m&amp;=P\{\min(X,Y)&gt;t_m\}=\prod_{j=1}^m q_j\label{eq:Qm}\\
d_m&amp;=P\{t_{m-1}&lt;X\le t_m,X\le Y\}\\
&amp;=P\{\min(X,Y)&gt;t_{m-1}\}\cdot P\{0&lt;\min (X_m,Y_m)\le t_m-t_{m-1},X_m\le Y_m\}\\
&amp;=P\{\min(X,Y)&gt;t_{m-1}\}\cdot P\{0&lt;\min (X_m,Y_m)\le t_m-t_{m-1}\}\cdot P\{X_m\le Y_m|0&lt;\min (X_m,Y_m)\le t_m-t_{m-1}\}\\
&amp;=Q_{m-1}(1-e^{-(\lambda_m+\eta_m)(t_m-t_{m-1})})
\frac{\lambda_m}{\lambda_m+\eta_m}\\
\bar n_m&amp;=E\{\bar n(t_{m-1},t_m)\}
\end{align}\]</span> Note that if <span class="math inline">\(\lambda_m+\eta_m=0\)</span>, we have <span class="math inline">\(d_m=0\)</span>.</p>
<p>From above, we have</p>
<p><span class="math display">\[\begin{align}
\bar n_m&amp;=G(t_M-t_m)P\{t_{m-1}&lt;X\leq t_m, X\leq Y\}+ 
\int_{t_M-t_m}^{t_M-t_{m-1}} g(u) P\{t_{m-1}&lt; X\leq t_M-u, X\leq Y\} du\\
&amp;=G_{M+1-m}d_m+P\{\min(X,Y)&gt;t_{m-1}\}
 \int_0^{t_m-t_{m-1}}g_{M+1-m}P\{X_m\le v, X_m\le Y_m\}dv\\
&amp;=G_{M+1-m}d_m  + \frac{Q_{m-1}g_{M+1-m}\lambda_m}{\lambda_m+\eta_m}
 \int_0^{t_m-t_{m-1}}\left(1-\exp^{-(\lambda_m+\eta_m)v}\right)dv\\
&amp;=G_{M+1-m}d_m  + \frac{Q_{m-1}g_{M+1-m}\lambda_m}{\lambda_m+\eta_m}
\left(t_m-t_{m-1}-\frac{1-\exp^{-(\lambda_m+\eta_m)(t_m-t_{m-1})}}{\lambda_m+\eta_m}\right)\\
&amp;=G_{M+1-m}d_m  + \frac{Q_{m-1}g_{M+1-m}\lambda_m}{\lambda_m+\eta_m}
\left(t_m-t_{m-1}-\frac{1-q_m}{\lambda_m+\eta_m}\right)
\end{align}\]</span></p>
<p>We now add <span class="math inline">\(q_m\)</span>, <span class="math inline">\(Q_m\)</span>, and <span class="math inline">\(d_m\)</span> to the calculations above to enable computation of <span class="math inline">\(\bar n_m\)</span>, the expected events in each time interval.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">namesTem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"tm"</span>, <span class="st">"lambda"</span>, <span class="st">"eta"</span>, <span class="st">"j"</span>, <span class="st">"omega"</span>, <span class="st">"gamma"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    tdel <span class="op">=</span> <span class="va">tm</span> <span class="op">-</span> <span class="fu">lag</span><span class="op">(</span><span class="va">tm</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">eta</span><span class="op">)</span> <span class="op">*</span> <span class="va">tdel</span><span class="op">)</span>,</span>
<span>    Q <span class="op">=</span> <span class="fu">lag</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span>, default <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    d <span class="op">=</span> <span class="va">Q</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">q</span><span class="op">)</span> <span class="op">*</span> <span class="va">lambda</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">eta</span><span class="op">)</span>,</span>
<span>    G <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    nbar <span class="op">=</span> <span class="va">G</span> <span class="op">*</span> <span class="va">d</span> <span class="op">+</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">*</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">gamma</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">eta</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">tdel</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">q</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="va">y</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">yy</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"$m$"</span>, <span class="st">"$t_m$"</span>, <span class="st">"$\\lambda_m$"</span>, <span class="st">"$\\eta_m$"</span>, <span class="st">"$j$"</span>,</span>
<span>  <span class="st">"$\\omega_j=t_M-t_{m-1}$"</span>,</span>
<span>  <span class="st">"$\\gamma_j$"</span>, <span class="st">"$t_m-t_{m-1}$"</span>, <span class="st">"$q_m$"</span>, <span class="st">"$Q_{m-1}$"</span>,</span>
<span>  <span class="st">"$d_m$"</span>, <span class="st">"$G_{j-1}$"</span>, <span class="st">"$\\bar{n}_m$"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="va">yy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="fl">12</span>, <span class="fl">8</span><span class="op">:</span><span class="fl">11</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"bordered"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_header_above</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Failure and dropout rates"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    <span class="st">"Enrollment"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    <span class="st">"Events by time period"</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Failure and dropout rates
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Enrollment
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Events by time period
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
<span class="math inline">\(m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(t_m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\lambda_m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\eta_m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(j\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\omega_j=t_M-t_{m-1}\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\gamma_j\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(G_{j-1}\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(t_m-t_{m-1}\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(q_m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(Q_{m-1}\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(d_m\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\bar{n}_m\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.8834
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.1129
</td>
<td style="text-align:right;">
0.5643
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9399
</td>
<td style="text-align:right;">
0.8834
</td>
<td style="text-align:right;">
0.0514
</td>
<td style="text-align:right;">
0.2570
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9399
</td>
<td style="text-align:right;">
0.8303
</td>
<td style="text-align:right;">
0.0483
</td>
<td style="text-align:right;">
0.1937
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9399
</td>
<td style="text-align:right;">
0.7804
</td>
<td style="text-align:right;">
0.0454
</td>
<td style="text-align:right;">
0.0688
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="verifying-calculations">Verifying calculations<a class="anchor" aria-label="anchor" href="#verifying-calculations"></a>
</h3>
<p>We check the above for the total number of events using the <strong>gsDesign</strong> function <code><a href="https://keaven.github.io/gsDesign/reference/eEvents.html" class="external-link">eEvents()</a></code>. First, we sum the <span class="math inline">\(\bar{n}_m\)</span> values <code>sum(y$nbar)</code> to get 1.083773 and compare to:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Events</span> <span class="op">&lt;-</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="fu"><a href="https://keaven.github.io/gsDesign/reference/eEvents.html" class="external-link">eEvents</a></span><span class="op">(</span></span>
<span>  lambda <span class="op">=</span> <span class="va">y</span><span class="op">$</span><span class="va">lambda</span>,</span>
<span>  eta <span class="op">=</span> <span class="va">y</span><span class="op">$</span><span class="va">eta</span>,</span>
<span>  gamma <span class="op">=</span> <span class="va">y</span><span class="op">$</span><span class="va">gamma</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">gamma</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  S <span class="op">=</span> <span class="va">y</span><span class="op">$</span><span class="va">tdel</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">tdel</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  R <span class="op">=</span> <span class="va">y</span><span class="op">$</span><span class="va">tdel</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">tdel</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  T <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">tm</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">d</span></span>
<span></span>
<span><span class="va">Events</span></span>
<span><span class="co">#&gt; [1] 1.083773</span></span></code></pre></div>
<p>Next, we examine by the periods defined by <code>failRates</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eEvents_df.html">eEvents_df</a></span><span class="op">(</span></span>
<span>  enrollRates <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  failRates <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span>, failRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.03</span>, <span class="fl">.06</span><span class="op">)</span>, dropoutRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.001</span>, <span class="fl">.002</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  totalDuration <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  simple <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;       t failRate Events</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0     0.03  0.564</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     4     0.06  0.519</span></span></code></pre></div>
<p>Now we group rows of <code>y</code> above into these same intervals.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    failRate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>,</span>
<span>    Events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nbar</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;       t failRate Events</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0     0.03  0.564</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     4     0.06  0.519</span></span></code></pre></div>
<p>Finally, we approximate specific numbers using simulation. First, we simulate a large dataset and confirm the simulation has the targeted enrollment pattern.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1e6</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu">simtrial</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/simtrial/reference/simPWSurv.html" class="external-link">simPWSurv</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="va">nsim</span>,</span>
<span>  block <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  enrollRates <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">nsim</span> <span class="op">/</span> <span class="fl">5</span>, duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  failRates <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    Stratum <span class="op">=</span> <span class="st">"All"</span>, period <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, Treatment <span class="op">=</span> <span class="st">"xx"</span>,</span>
<span>    rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.03</span>, <span class="fl">.06</span><span class="op">)</span>, duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dropoutRates <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    Stratum <span class="op">=</span> <span class="st">"All"</span>, period <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, Treatment <span class="op">=</span> <span class="st">"xx"</span>,</span>
<span>    rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.001</span>, <span class="fl">.002</span><span class="op">)</span>, duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">xx</span>, file <span class="op">=</span> <span class="st">"./fixtures/compute_expected_events.Rdata"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"./fixtures/compute_expected_events.Rdata"</span><span class="op">)</span></span>
<span><span class="va">ecat</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">xx</span><span class="op">$</span><span class="va">enrollTime</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">xx</span><span class="op">$</span><span class="va">enrollTime</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Enrollment pattern: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ecat</span><span class="op">)</span> <span class="op">/</span> <span class="va">nsim</span><span class="op">)</span></span>
<span><span class="co">#&gt; Enrollment pattern:  0.599697 0.399995 0.000308</span></span></code></pre></div>
<p>Now we confirm the expected events in each follow-up interval given the targeted enrollment.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="va">xx</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">simtrial</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/simtrial/reference/cutData.html" class="external-link">cutData</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tcat <span class="op">=</span> <span class="fl">4</span> <span class="op">+</span> <span class="op">(</span><span class="va">tte</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">tte</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">tte</span> <span class="op">&gt;</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Event by interval: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">yy</span><span class="op">$</span><span class="va">tcat</span><span class="op">)</span> <span class="op">/</span> <span class="va">nsim</span> <span class="op">*</span> <span class="fl">5</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Event by interval:  0.56421 0.2591 0.19403 0.067865</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total events: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">yy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span> <span class="op">/</span> <span class="va">nsim</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total events:  1.085205</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-Kalbfleisch1981">
<p>Kalbfleisch, John D, and Ross L Prentice. 1981. “Estimation of the Average Hazard Ratio.” <em>Biometrika</em> 68 (1): 105–12.</p>
</div>
<div id="ref-LachinFoulkes">
<p>Lachin, John M., and Mary A. Foulkes. 1986. “Evaluation of Sample Size and Power for Analyses of Survival with Allowance for Nonuniform Patient Entry, Losses to Follow-up, Noncompliance, and Stratification.” <em>Biometrics</em> 42: 507–19.</p>
</div>
<div id="ref-Schemper2009">
<p>Schemper, Michael, Samo Wakounig, and Georg Heinze. 2009. “The Estimation of Average Hazard Ratios by Weighted Cox Regression.” <em>Statistics in Medicine</em> 28 (19): 2473–89.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Keaven Anderson, Yilong Zhang, Yujie Zhao. Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6. <br>Copyright © 2022 Merck &amp; Co., Inc., Rahway, NJ, USA and its affiliates. All rights reserved.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p><span></span></p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
