<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Approximating an Arbitrary Survival Distribution • gsDesign2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Approximating an Arbitrary Survival Distribution">
<meta property="og:description" content="gsDesign2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gsDesign2</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Initial Version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AHRVignette.html">Average hazard ratio and sample size under non-proportional hazards</a>
    </li>
    <li>
      <a href="../articles/ArbitraryDistribution.html">Approximating an Arbitrary Survival Distribution</a>
    </li>
    <li>
      <a href="../articles/eEventsTheory.html">Computing expected events by interval at risk</a>
    </li>
    <li>
      <a href="../articles/testing_AHR.html">Simulation for testing average hazard ratio and sample size under non-proportional hazards</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ArbitraryDistribution_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Approximating an Arbitrary Survival Distribution</h1>
                        <h4 class="author">Keaven Anderson</h4>
            
      
      
      <div class="hidden name"><code>ArbitraryDistribution.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">simtrial</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gsDesign</span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>We demonstrate how to approximate arbitrary continuous survival distibutions with piecewise exponential approximations. This enables sample size computations for arbitrary survival models using software designed for the piecewise exponential distribution. Three functions in particular are demonstrated:</p>
<ul>
<li>‘s2ppwe()’ translates an arbitrary survival distribution to piecewise exponential.</li>
<li>‘ppwe()’ computes a cumulative survival distribution or its upper tail for a distribution in the form generated by ‘s2ppwe()’.</li>
<li>‘pPM()’ provides the cumulative survival distribution for a Poisson mixture distribution.</li>
</ul>
</div>
<div id="lognormal-approximation" class="section level2">
<h2 class="hasAnchor">
<a href="#lognormal-approximation" class="anchor"></a>Lognormal approximation</h2>
<p>We demonstrate ‘s2pwe()’ by approximating the lognormal distribution with piecewise exponential failure rates. Note that when the resulting ‘lnormRates’ is used, the final piecewise exponential ‘duration’ is extended. That is, we have arbitrarily approximated with 6 piecewise exponential rates for a duration of 1 unit of time (say, month) followed by a final rate which extends to infinity.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gsDesign2</span><span class="op">)</span>
<span class="va">lnormRates</span> <span class="op">&lt;-</span>  <span class="fu">gsDesign2</span><span class="fu">::</span><span class="fu"><a href="../reference/s2pwe.html">s2pwe</a></span><span class="op">(</span>times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">9</span><span class="op">)</span>,
                               survival <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">plnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">9</span><span class="op">)</span>, meanlog<span class="op">=</span><span class="fl">0</span>, sdlog<span class="op">=</span><span class="fl">2</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">lnormRates</span></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##   duration  rate
##      &lt;dbl&gt; &lt;dbl&gt;
## 1        1 0.693
## 2        1 0.316
## 3        1 0.224
## 4        1 0.177
## 5        1 0.148
## 6        1 0.128
## 7        3 0.103</code></pre>
<p>We compare the resulting approximation to the actual lognormal survival using ‘ppwe()’ to compute survival probabilities <span class="math inline">\(P\{T&gt;t\}\)</span>. For a better approximation, use a larger number of points. We plot with a log scale on the y-axis since the piecewise exponential survival from ‘ppwe()’ is piecewise linear on this scale. We note that at the beginning of each rate period in the approximation the actual survival distribution and its approximation match exactly as indicated by the circles on the graph.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use a large number of points to plot lognormal survival</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span>,<span class="fl">.025</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">times</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">plnorm</a></span><span class="op">(</span><span class="va">times</span>,meanlog<span class="op">=</span><span class="fl">0</span>,sdlog<span class="op">=</span><span class="fl">2</span>,lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,log<span class="op">=</span><span class="st">"y"</span>,type<span class="op">=</span><span class="st">"l"</span>,
     main<span class="op">=</span><span class="st">"Lognormal Distribution vs. Piecewise Approximation"</span>,yaxt<span class="op">=</span><span class="st">'n'</span>,
     ylab<span class="op">=</span><span class="st">"log(Survival)"</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="co"># Now plot the pieceise approximation using the 7-point approximation from above</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">times</span>, <span class="fu">gsDesign2</span><span class="fu">::</span><span class="fu"><a href="../reference/ppwe.html">ppwe</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">times</span>, failRates<span class="op">=</span><span class="va">lnormRates</span><span class="op">)</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="co"># Finally, add point markers at the points used in the approximation</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">plnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,meanlog<span class="op">=</span><span class="fl">0</span>,sdlog<span class="op">=</span><span class="fl">2</span>,lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.4</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Log-normal"</span>,<span class="st">"Piecewise Approximation (7 pts)"</span><span class="op">)</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<p><img src="ArbitraryDistribution_files/figure-html/unnamed-chunk-3-1.png" width="624"></p>
<p>We considered the lognormal distribution due to the flexibility it allows for hazard rates over time; see, for example, <a href="https://en.wikipedia.org/wiki/Log-normal_distribution">Wikipedia</a>.</p>
</div>
<div id="poisson-mixture-model" class="section level2">
<h2 class="hasAnchor">
<a href="#poisson-mixture-model" class="anchor"></a>Poisson mixture model</h2>
<p>We consider a Poisson mixture model to incorporate a cure model into sample size planning. The form of the survival function for this is</p>
<p><span class="math display">\[S(t)=\exp(-\theta F_0(t))\]</span> for <span class="math inline">\(t\ge 0\)</span> where <span class="math inline">\(F_0(t)\)</span> is a continuous cumulative distribution function for a non-negative random variable with <span class="math inline">\(F_0(0)=0\)</span> and <span class="math inline">\(F_0(t)\uparrow 1\)</span> as <span class="math inline">\(t\uparrow \infty\)</span>. We note that as <span class="math inline">\(t\uparrow \infty\)</span>, <span class="math inline">\(S(t)\downarrow \exp(-\theta)=c\)</span> where we will refer to <span class="math inline">\(c\)</span> as the cure rate. The function ‘pPM()’ assumes <span class="math inline">\(F_0(t)=1-\exp(-\lambda t)\)</span> is an exponential cumulative distribution function resulting in the survival distribution for <span class="math inline">\(t\ge 0\)</span>:</p>
<p><span class="math display">\[S(t; \theta, \lambda) = \exp(-\theta(1-\exp(-\lambda t))).\]</span> Note that we set the default of ‘lower.tail=FALSE’ so that the survival function computation is the default:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pPM</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">theta</span>, <span class="va">lambda</span>, <span class="va">lower.tail</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">theta</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">lambda</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We plot this with <span class="math inline">\(\lambda = \log(2) / 10\)</span> to make <span class="math inline">\(F_0(t)\)</span> an exponential distibution with a median of 10. We set <span class="math inline">\(\theta = -\log(.4)\)</span> to obtain a cure rate of 0.4. we then overlay with the piecewise exponential approximation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">)</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">40</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">times</span>, <span class="fu">pPM</span><span class="op">(</span><span class="va">times</span>, <span class="va">theta</span>, <span class="va">lambda</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, ylab<span class="op">=</span><span class="st">"Survival"</span>, xlab<span class="op">=</span><span class="st">"Time"</span>, log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span>
<span class="co"># Now compute piecewise expoential approximation</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">40</span>, <span class="fl">8</span><span class="op">)</span>
<span class="va">pmRates</span> <span class="op">&lt;-</span>  <span class="fu">gsDesign2</span><span class="fu">::</span><span class="fu"><a href="../reference/s2pwe.html">s2pwe</a></span><span class="op">(</span>times <span class="op">=</span> <span class="va">x</span>,
                             survival <span class="op">=</span><span class="fu">pPM</span><span class="op">(</span><span class="va">x</span>, theta <span class="op">=</span> <span class="va">theta</span>, lambda <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Now plot the pieceise approximation using the 7-point approximation from above</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">x</span><span class="op">)</span>, <span class="fu">gsDesign2</span><span class="fu">::</span><span class="fu"><a href="../reference/ppwe.html">ppwe</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">x</span><span class="op">)</span>, failRates<span class="op">=</span><span class="va">pmRates</span><span class="op">)</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">x</span><span class="op">)</span>, <span class="fu">pPM</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">x</span><span class="op">)</span>, <span class="va">theta</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="ArbitraryDistribution_files/figure-html/unnamed-chunk-5-1.png" width="624"></p>
<p>We note that two different <span class="math inline">\(\theta\)</span> values provide a proportional hazards model in that the ratio of cumulative hazard function <span class="math inline">\(H(t; \theta, \lambda) = \theta\exp(-\lambda t)\)</span> is constant:</p>
<p><span class="math display">\[\frac{\log(S(t; \theta_1, \lambda))}{\log(S(t; \theta_2, \lambda))} = \theta_1/\theta_2.\]</span></p>
<p>For a given <span class="math inline">\(\theta\)</span> value we can compute <span class="math inline">\(\lambda\)</span> to provide a survival rate <span class="math inline">\(c_1 &gt; \exp(-\theta)\)</span> at an arbitrary time <span class="math inline">\(t_1&gt;0\)</span> by setting:</p>
<p><span class="math display">\[\lambda = -\log\left(\frac{\theta - \log(c_1)}{\theta}\right)/t_1.\]</span></p>
<p>We compute <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\lambda\)</span> values with a cure rate of 0.4 and a survival rate of 0.6 at 30 months:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="op">(</span><span class="va">theta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">.6</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">theta</span><span class="op">)</span> <span class="op">/</span> <span class="fl">30</span></code></pre></div>
<p>We confirm the survival at time 30:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pPM</span><span class="op">(</span><span class="fl">30</span>, <span class="va">theta</span>, <span class="va">lambda</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.6</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Keaven Anderson, Yilong Zhang. Site built with pkgdown 1.6.1.
  </p>
  <p>Copyright © 2021 Merck Sharp &amp; Dohme Corp., a subsidiary of Merck &amp; Co., Inc., Kenilworth, NJ, USA.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
